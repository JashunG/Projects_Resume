import nmap
import json

# Initialize the scanner
scanner = nmap.PortScanner()

# Welcome message
print("Welcome to the Vulnerability Scanner!")
target = input("Enter the target IP address: ")
ports = input("Enter the range of ports to scan (e.g., 1-1024): ")

print(f"\nScanning {target} on ports {ports}...")

try:
    # Perform the scan with verbose mode
    scanner.scan(hosts=target, ports=ports, arguments='-sT -v')

    # Check if target has scan results
    if target not in scanner.all_hosts():
        print(f"\nError: No response from {target}. Ensure the IP address is correct and try again.")
    else:
        # Save scan results to JSON file
        with open("scan_report.json", "w") as report:
            json.dump(scanner[target], report, indent=4)

        # Display scan results
        print("\nScan Results:")
        print(f"IP Status: {scanner[target].state()}")  # Check if host is up or down
        print("\nProtocols Found:")
        protocols = scanner[target].all_protocols()
        for protocol in protocols:
            print(f"\nProtocol: {protocol}")
            ports = scanner[target][protocol].keys()
            for port in ports:
                print(f"Port: {port}, State: {scanner[target][protocol][port]['state']}")

        print("\nScan completed. Results saved to 'scan_report.json'.")

except Exception as e:
    print(f"\nError: Unable to scan {target}. Details: {e}")
